<h2><%=h @match.name %></h2>
<% if !@match.active %>
	<h3>This match is over.</h3>
<% elsif current_user == @match.admin %>
	<%= link_to 'Close this match', complete_match_match_path(@match) %>
<% end %>
<p>
  <b>Admin:</b> <%= link_to h(@match.admin.fullname), @match.admin %>
</p>

<p>
  <b>Github:</b> <%= link_to h(@match.github_url), h(@match.github_url) %>
</p>

<p>
  <b>Description:</b>
  <%=h @match.description %>
</p>

<h3>Players:</h3>
<% if !@match.players.blank? %>
<ul>
  <% for user in @match.players.map(&:user) %>
  <li><%= link_to(h(user.fullname), user) %></li>
  <% end %>  
</ul>
<% else %>
<p>No players yet for this match.</p>
<% end %>

<h3>Volleys</h3>
<% if current_user == @match.admin %>
	<%= link_to 'End current volley', complete_volley_match_path(@match)  %>
<% end %>


<%- if !@match.volleys.blank? -%>
  <ul>
  <% for volley in @match.volleys %>
    <li>
      <%- if !volley.commits.blank? -%>
      <%= link_to h(volley.player.user.fullname), volley.player.user %>
      <ul>
        <% for commit in volley.commits %>
        <li>
          <%= link_to h(commit.guid), h(commit.url) %>
          <%= link_to h(commit.player.user.fullname), commit.player.user.github_url %>
          <%= link_to h(commit.message), h(commit.url) %>
        </li>
        <% end %>
      </ul>
      <%- else -%>
      <%= link_to h(volley.player.user.fullname), volley.player.user %> hasn't made any commits yet.
      <%- end -%>
    </li>
  <% end %>
  </ul>
<%- else -%>
<p>No volleys have been served.</p>
<%- end -%>


<p>
  <%= link_to "Back", matches_path %>
  <% if @match.admin == current_user %>| <%= link_to "Edit", edit_match_path(@match) %><% end %>
</p>
